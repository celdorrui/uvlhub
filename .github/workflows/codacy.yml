name: Codacy Analysis

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  analyze:
    name: Analyze with Codacy
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: ["3.10", "3.11", "3.12"]
    
    steps:
    # Paso 1: Obtener el c√≥digo
    - name: Checkout code
      uses: actions/checkout@v4
    
    # Paso 2: Configurar Python
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    # Paso 3: Instalar dependencias
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
    
    # ‚úÖ MODIFICACI√ìN 1: Verificar nuevas versiones de dependencias
    - name: Check for dependency updates
      run: |
        echo "üîç Checking for outdated dependencies..."
        pip list --outdated --format=columns
    
    # ‚úÖ MODIFICACI√ìN 2: Ya est√° implementada con matrix de Python
    
    # ‚úÖ MODIFICACI√ìN 3: An√°lisis de seguridad
    - name: Security audit with pip-audit
      run: |
        pip install pip-audit
        pip-audit
    
    # Paso 4: Ejecutar tests (si tienes)
    - name: Run tests
      run: |
        python -m pytest --cov=./ --cov-report=xml
    
    # Paso 5: An√°lisis Codacy
    - name: Codacy Analysis
      uses: codacy/codacy-analysis-cli-action@v4
      with:
        project-token: ${{ secrets.CODACY_PROJECT_TOKEN }}
        coverage-reports: coverage.xml
